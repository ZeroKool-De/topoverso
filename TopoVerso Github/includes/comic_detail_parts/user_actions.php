<?php
// topolinolib/includes/comic_detail_parts/user_actions.php
?>
<?php if ($user_id_frontend): ?>
    <div class="comic-user-actions"><h4>La Mia Collezione</h4><?php if ($comic_in_collection === null): ?><form action="collection_actions.php" method="POST"><input type="hidden" name="comic_id" value="<?php echo $comic_id; ?>"><input type="hidden" name="action" value="add_to_collection"><input type="hidden" name="redirect_url" value="<?php echo htmlspecialchars($_SERVER['REQUEST_URI']); ?>"><button type="submit" class="btn btn-collection btn-add-collection">Aggiungi alla Mia Collezione</button></form>
        <?php else: ?><p>Questo fumetto Ã¨ nella tua collezione.</p><form action="collection_actions.php" method="POST" style="margin-bottom: 10px;"><input type="hidden" name="comic_id" value="<?php echo $comic_id; ?>"><input type="hidden" name="action" value="update_read_status"><input type="hidden" name="redirect_url" value="<?php echo htmlspecialchars($_SERVER['REQUEST_URI']); ?>"><div class="form-group"><label for="is_read_detail_<?php echo $comic_id; ?>">L'ho letto:</label><input type="checkbox" name="is_read" id="is_read_detail_<?php echo $comic_id; ?>" value="1" <?php echo $comic_in_collection['is_read'] ? 'checked' : ''; ?>><button type="submit" class="btn btn-update btn-sm">Aggiorna</button></div></form><form action="collection_actions.php" method="POST" style="margin-bottom: 10px;"><input type="hidden" name="comic_id" value="<?php echo $comic_id; ?>"><input type="hidden" name="action" value="update_rating"><input type="hidden" name="redirect_url" value="<?php echo htmlspecialchars($_SERVER['REQUEST_URI']); ?>"><div class="form-group"><label for="rating_detail_<?php echo $comic_id; ?>">Il Mio Voto:</label><select name="rating" id="rating_detail_<?php echo $comic_id; ?>"><option value="0" <?php echo is_null($comic_in_collection['rating']) || $comic_in_collection['rating'] == 0 ? 'selected' : ''; ?>>-- Dai un voto --</option><?php for ($i = 1; $i <= 5; $i++): ?><option value="<?php echo $i; ?>" <?php echo (!is_null($comic_in_collection['rating']) && $comic_in_collection['rating'] == $i) ? 'selected' : ''; ?>><?php echo $i; ?> Stella<?php echo $i > 1 ? 'e' : ''; ?></option><?php endfor; ?></select><button type="submit" class="btn btn-update btn-sm">Vota</button></div></form><form action="collection_actions.php" method="POST"><input type="hidden" name="comic_id" value="<?php echo $comic_id; ?>"><input type="hidden" name="action" value="remove_from_collection"><input type="hidden" name="redirect_url" value="<?php echo htmlspecialchars($_SERVER['REQUEST_URI']); ?>"><button type="submit" class="btn btn-collection btn-remove-collection" onclick="return confirm('Rimuovere dalla collezione?');">Rimuovi dalla Collezione</button></form>
        <?php endif; ?></div>
<?php else: ?><p style="margin-top:15px;"><a href="login.php?redirect=<?php echo urlencode($_SERVER['REQUEST_URI']); ?>">Accedi</a> o <a href="register.php">Registrati</a> per aggiungere questo fumetto alla tua collezione e votarlo.</p><?php endif; ?>